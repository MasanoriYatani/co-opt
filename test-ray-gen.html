<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ray-renderer „ÉÜ„Çπ„Éà</title>
    <style>
        body { font-family: monospace; margin: 20px; background: #f0f0f0; }
        .test-result { background: white; padding: 15px; margin: 10px 0; border-radius: 5px; border-left: 4px solid #ccc; }
        .success { border-left-color: #00aa00; }
        .error { border-left-color: #cc0000; }
        .warning { border-left-color: #ff6600; }
        h1 { color: #333; }
        code { background: #eee; padding: 2px 5px; border-radius: 3px; font-size: 0.9em; }
    </style>
</head>
<body>
    <h1>ray-renderer.js „ÉÜ„Çπ„Éà</h1>
    <div id="results"></div>

    <script type="module">
        const resultsDiv = document.getElementById('results');

        function addResult(title, message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = `<strong>${title}:</strong><br>${message}`;
            resultsDiv.appendChild(div);
            console.log(`[${type.toUpperCase()}] ${title}: ${message}`);
        }

        try {
            // ray-renderer.js „Çí„Ç§„É≥„Éù„Éº„Éà
            const rayRenderer = await import('./optical/ray-renderer.js');
            
            addResult('‚úÖ ImportÊàêÂäü', 'ray-renderer.js„Çí„Ç§„É≥„Éù„Éº„Éà„Åó„Åæ„Åó„Åü', 'success');

            // ÂøÖÈ†àÈñ¢Êï∞„ÅÆÁ¢∫Ë™ç
            const requiredFunctions = [
                'generateRayStartPointsForObject',
                'normalizeAnnularRingCount'
            ];

            for (const fname of requiredFunctions) {
                if (typeof rayRenderer[fname] === 'function') {
                    addResult(
                        `‚úÖ Èñ¢Êï∞: ${fname}`,
                        'Èñ¢Êï∞„ÅåÊ≠£„Åó„Åè„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åï„Çå„Å¶„ÅÑ„Åæ„Åô',
                        'success'
                    );
                } else {
                    addResult(
                        `‚ùå Èñ¢Êï∞: ${fname}`,
                        `Èñ¢Êï∞„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì„ÄÇÂûã: ${typeof rayRenderer[fname]}`,
                        'error'
                    );
                }
            }

            // normalizeAnnularRingCount „ÅÆ„ÉÜ„Çπ„Éà
            addResult('üß™ normalizeAnnularRingCount „ÉÜ„Çπ„Éà', '„ÉÜ„Çπ„ÉàÂÆüË°å‰∏≠...', 'warning');
            
            const testValues = [
                { input: null, expected: null },
                { input: undefined, expected: null },
                { input: 3, expected: 3 },
                { input: 8, expected: 8 },
                { input: 16, expected: 16 },
                { input: 32, expected: 32 },
                { input: 33, expected: 32 },  // Should be clamped
                { input: 0, expected: null },
                { input: -1, expected: null }
            ];

            let normalizeTests = [];
            for (const test of testValues) {
                try {
                    const result = rayRenderer.normalizeAnnularRingCount(test.input);
                    const passed = result === test.expected;
                    normalizeTests.push({
                        input: test.input,
                        expected: test.expected,
                        actual: result,
                        passed
                    });
                } catch (e) {
                    normalizeTests.push({
                        input: test.input,
                        error: e.message
                    });
                }
            }

            const allPassed = normalizeTests.every(t => t.passed !== false);
            const testSummary = normalizeTests.map(t => 
                t.error ? 
                    `‚ùå input=${t.input} ‚Üí ERROR: ${t.error}` :
                    `${t.passed ? '‚úÖ' : '‚ùå'} input=${t.input} ‚Üí expected=${t.expected}, actual=${t.actual}`
            ).join('<br>');

            addResult(
                `${allPassed ? '‚úÖ' : '‚ùå'} normalizeAnnularRingCount „ÉÜ„Çπ„Éà`,
                testSummary,
                allPassed ? 'success' : 'error'
            );

        } catch (error) {
            addResult(
                '‚ùå Fatal Error',
                `${error.name}: ${error.message}<br><pre>${error.stack}</pre>`,
                'error'
            );
        }
    </script>
</body>
</html>
