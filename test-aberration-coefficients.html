<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¢ãƒ•ã‚©ãƒ¼ã‚«ãƒ«ç³»åå·®ä¿‚æ•°è¨ˆç®—ãƒ†ã‚¹ãƒˆ</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            margin: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
        }
        h1 {
            color: #4ec9b0;
        }
        .results {
            background: #252526;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success {
            color: #4ec9b0;
        }
        .error {
            color: #f48771;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin: 10px 0;
        }
        th, td {
            border: 1px solid #3e3e42;
            padding: 8px;
            text-align: right;
        }
        th {
            background: #2d2d30;
            color: #4ec9b0;
        }
        .expected {
            color: #569cd6;
        }
        .actual {
            color: #dcdcaa;
        }
        .diff-good {
            color: #4ec9b0;
        }
        .diff-bad {
            color: #f48771;
        }
    </style>
</head>
<body>
    <h1>ğŸ”¬ ã‚¢ãƒ•ã‚©ãƒ¼ã‚«ãƒ«ç³»åå·®ä¿‚æ•°è¨ˆç®—ãƒ†ã‚¹ãƒˆ</h1>
    <div class="results">
        <h2>ğŸ“‹ å…‰å­¦ç³»ãƒ‡ãƒ¼ã‚¿ï¼ˆ40mmæ­£è¦åŒ–å˜ä½ç³»ï¼‰</h2>
        <div id="system-info"></div>
    </div>
    <div class="results">
        <h2>ğŸ“ è¿‘è»¸å…‰ç·šè¿½è·¡çµæœ</h2>
        <div id="paraxial-results"></div>
    </div>
    <div class="results">
        <h2>ğŸ“Š åå·®ä¿‚æ•°</h2>
        <div id="aberration-coefficients"></div>
    </div>
    <div class="results">
        <h2>âœ… æ¤œè¨¼çµæœï¼ˆTable 1ã¨ã®æ¯”è¼ƒï¼‰</h2>
        <div id="validation"></div>
    </div>

    <script type="module">
        import { calculateAfocalSeidelCoefficients } from './eva-seidel-coefficients-afocal.js';

        // ãƒ†ã‚¹ãƒˆç”¨å…‰å­¦ç³»ãƒ‡ãƒ¼ã‚¿ï¼ˆTable 1ã®ãƒ†ãƒ¬ã‚»ãƒ³ãƒˆãƒªãƒƒã‚¯çµåƒç³»ï¼‰
        // å˜ä½: mm
        const opticalSystemRows_mm = [
            { surfType: 'Spherical', 'object type': 'Object', radius: 'INF', thickness: 127.39, semidia: 50, material: '', stopSurf: false },
            { surfType: 'Spherical', 'object type': '', radius: 'INF', thickness: 100, semidia: 50, material: '1', stopSurf: false },
            { surfType: 'Spherical', 'object type': '', radius: 100, thickness: 10, semidia: 50, material: '1.5', stopSurf: false },
            { surfType: 'Spherical', 'object type': '', radius: -300, thickness: 10, semidia: 50, material: '1', stopSurf: false },
            { surfType: 'Spherical', 'object type': '', radius: 200, thickness: 10, semidia: 50, material: '1.5', stopSurf: false },
            { surfType: 'Spherical', 'object type': '', radius: -100, thickness: 10, semidia: 50, material: '1', stopSurf: false },
            { surfType: 'Spherical', 'object type': '', radius: -200, thickness: 10, semidia: 50, material: '1.5', stopSurf: false },
            { surfType: 'Spherical', 'object type': '', radius: 300, thickness: 90, semidia: 50, material: '1', stopSurf: false },
            { surfType: 'Spherical', 'object type': 'Stop', radius: 'INF', thickness: 10, semidia: 40, material: '1', stopSurf: true },
            { surfType: 'Spherical', 'object type': '', radius: -300, thickness: 10, semidia: 50, material: '1.5', stopSurf: false },
            { surfType: 'Spherical', 'object type': '', radius: 200, thickness: 10, semidia: 50, material: '1', stopSurf: false },
            { surfType: 'Spherical', 'object type': '', radius: 100, thickness: 10, semidia: 50, material: '1.5', stopSurf: false },
            { surfType: 'Spherical', 'object type': '', radius: -200, thickness: 10, semidia: 50, material: '1', stopSurf: false },
            { surfType: 'Spherical', 'object type': '', radius: 300, thickness: 10, semidia: 50, material: '1.5', stopSurf: false },
            { surfType: 'Spherical', 'object type': '', radius: -100, thickness: 100, semidia: 50, material: '1', stopSurf: false },
            { surfType: 'Spherical', 'object type': 'Image', radius: 'INF', thickness: 0, semidia: 50, material: '', stopSurf: false }
        ];

        // Table 1 ã®æœŸå¾…å€¤ï¼ˆ40mmæ­£è¦åŒ–å˜ä½ç³»ï¼‰
        const expected = {
            alpha1_chief: -1.0,
            h1_chief: 3.18288,
            alpha1_marginal: -0.0111031,
            h1_marginal: -0.964659
        };

        // åå·®ä¿‚æ•°è¨ˆç®—å®Ÿè¡Œ
        console.log('ğŸš€ ã‚¢ãƒ•ã‚©ãƒ¼ã‚«ãƒ«ç³»åå·®ä¿‚æ•°è¨ˆç®—é–‹å§‹...\n');
        
        const result = calculateAfocalSeidelCoefficients(opticalSystemRows_mm, 0.5875618, 8); // Surface 8 ãŒ Stop

        // å…‰å­¦ç³»æƒ…å ±ã‚’è¡¨ç¤º
        const systemInfo = document.getElementById('system-info');
        systemInfo.innerHTML = `
            <p>ğŸ“ å˜ä½ç³»: 40mm = 1 unit</p>
            <p>ğŸ“ ä¸»å…‰ç·šåˆæœŸè§’åº¦: Î±0 = -1.0 rad</p>
            <p>ğŸ¯ Stopé¢: Surface 8</p>
            <p>ğŸ“ Object-to-Surface1: ${opticalSystemRows_mm[0].thickness}mm = ${(opticalSystemRows_mm[0].thickness / 40).toFixed(6)} unit</p>
        `;

        // è¿‘è»¸å…‰ç·šè¿½è·¡çµæœã‚’è¡¨ç¤º
        const paraxialDiv = document.getElementById('paraxial-results');
        if (result && result.traceResult) {
            const { chief, marginal } = result.traceResult;
            
            // ç¬¬1é¢ã§ã®å€¤
            const chief1 = chief[1];
            const marginal1 = marginal[1];
            
            const alpha1_chief_actual = chief1.alpha;
            const h1_chief_actual = chief1.h;
            const alpha1_marginal_actual = marginal1.alpha;
            const h1_marginal_actual = marginal1.h;
            
            const alpha1_chief_error = Math.abs(alpha1_chief_actual - expected.alpha1_chief);
            const h1_chief_error = Math.abs(h1_chief_actual - expected.h1_chief);
            const alpha1_marginal_error = Math.abs(alpha1_marginal_actual - expected.alpha1_marginal);
            const h1_marginal_error = Math.abs(h1_marginal_actual - expected.h1_marginal);
            
            const tolerance = 1e-5;  // è¨±å®¹èª¤å·®
            
            paraxialDiv.innerHTML = `
                <h3>ğŸ”µ ä¸»å…‰ç·šï¼ˆChief Rayï¼‰- ç¬¬1é¢</h3>
                <table>
                    <tr>
                        <th>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</th>
                        <th class="expected">æœŸå¾…å€¤</th>
                        <th class="actual">è¨ˆç®—å€¤</th>
                        <th>èª¤å·®</th>
                    </tr>
                    <tr>
                        <td>Î±â‚</td>
                        <td class="expected">${expected.alpha1_chief.toFixed(8)}</td>
                        <td class="actual">${alpha1_chief_actual.toFixed(8)}</td>
                        <td class="${alpha1_chief_error < tolerance ? 'diff-good' : 'diff-bad'}">${alpha1_chief_error.toExponential(2)}</td>
                    </tr>
                    <tr>
                        <td>hâ‚</td>
                        <td class="expected">${expected.h1_chief.toFixed(6)}</td>
                        <td class="actual">${h1_chief_actual.toFixed(6)}</td>
                        <td class="${h1_chief_error < tolerance ? 'diff-good' : 'diff-bad'}">${h1_chief_error.toExponential(2)}</td>
                    </tr>
                </table>
                
                <h3>ğŸ”´ å­åˆå…‰ç·šï¼ˆMarginal Rayï¼‰- ç¬¬1é¢</h3>
                <table>
                    <tr>
                        <th>ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿</th>
                        <th class="expected">æœŸå¾…å€¤</th>
                        <th class="actual">è¨ˆç®—å€¤</th>
                        <th>èª¤å·®</th>
                    </tr>
                    <tr>
                        <td>á¾±â‚</td>
                        <td class="expected">${expected.alpha1_marginal.toFixed(8)}</td>
                        <td class="actual">${alpha1_marginal_actual.toFixed(8)}</td>
                        <td class="${alpha1_marginal_error < tolerance ? 'diff-good' : 'diff-bad'}">${alpha1_marginal_error.toExponential(2)}</td>
                    </tr>
                    <tr>
                        <td>hÌ„â‚</td>
                        <td class="expected">${expected.h1_marginal.toFixed(6)}</td>
                        <td class="actual">${h1_marginal_actual.toFixed(6)}</td>
                        <td class="${h1_marginal_error < tolerance ? 'diff-good' : 'diff-bad'}">${h1_marginal_error.toExponential(2)}</td>
                    </tr>
                </table>
            `;
        }

        // åå·®ä¿‚æ•°ã‚’è¡¨ç¤º
        const aberrationDiv = document.getElementById('aberration-coefficients');
        if (result && result.coefficients) {
            let tableHTML = `
                <table>
                    <tr>
                        <th>Surface</th>
                        <th>Type</th>
                        <th>SI</th>
                        <th>SII</th>
                        <th>SIII</th>
                        <th>SIV</th>
                        <th>SV</th>
                    </tr>
            `;
            
            result.coefficients.forEach(c => {
                tableHTML += `
                    <tr>
                        <td>${c.surface}</td>
                        <td>${c.objectType || c.surfaceType}</td>
                        <td>${c.SI.toExponential(3)}</td>
                        <td>${c.SII.toExponential(3)}</td>
                        <td>${c.SIII.toExponential(3)}</td>
                        <td>${c.SIV.toExponential(3)}</td>
                        <td>${c.SV.toExponential(3)}</td>
                    </tr>
                `;
            });
            
            tableHTML += `
                <tr style="background: #3e3e42; font-weight: bold;">
                    <td colspan="2">åˆè¨ˆ</td>
                    <td>${result.totals.SI.toExponential(3)}</td>
                    <td>${result.totals.SII.toExponential(3)}</td>
                    <td>${result.totals.SIII.toExponential(3)}</td>
                    <td>${result.totals.SIV.toExponential(3)}</td>
                    <td>${result.totals.SV.toExponential(3)}</td>
                </tr>
            `;
            
            tableHTML += '</table>';
            aberrationDiv.innerHTML = tableHTML;
        }

        // æ¤œè¨¼çµæœã‚’è¡¨ç¤º
        const validationDiv = document.getElementById('validation');
        if (result && result.traceResult) {
            const { chief, marginal } = result.traceResult;
            const chief1 = chief[1];
            const marginal1 = marginal[1];
            
            const allGood = 
                Math.abs(chief1.alpha - expected.alpha1_chief) < tolerance &&
                Math.abs(chief1.h - expected.h1_chief) < tolerance &&
                Math.abs(marginal1.alpha - expected.alpha1_marginal) < tolerance &&
                Math.abs(marginal1.h - expected.h1_marginal) < tolerance;
            
            if (allGood) {
                validationDiv.innerHTML = `
                    <p class="success">âœ… ã™ã¹ã¦ã®è¿‘è»¸ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒTable 1ã®æœŸå¾…å€¤ã¨ä¸€è‡´ã—ã¾ã—ãŸï¼</p>
                    <p class="success">âœ… åå·®ä¿‚æ•°ã®è¨ˆç®—ãŒæ­£ã—ãå®Ÿè¡Œã•ã‚Œã¾ã—ãŸã€‚</p>
                    <p class="success">âœ… ã‚¢ãƒ•ã‚©ãƒ¼ã‚«ãƒ«ç³»ã®åˆæœŸæ¡ä»¶ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚</p>
                    <h3>ğŸ“Š æ¤œè¨¼ã‚µãƒãƒªãƒ¼</h3>
                    <ul>
                        <li>âœ… ä¸»å…‰ç·š Î±â‚: èª¤å·® ${Math.abs(chief1.alpha - expected.alpha1_chief).toExponential(2)}</li>
                        <li>âœ… ä¸»å…‰ç·š hâ‚: èª¤å·® ${Math.abs(chief1.h - expected.h1_chief).toExponential(2)}</li>
                        <li>âœ… å­åˆå…‰ç·š á¾±â‚: èª¤å·® ${Math.abs(marginal1.alpha - expected.alpha1_marginal).toExponential(2)}</li>
                        <li>âœ… å­åˆå…‰ç·š hÌ„â‚: èª¤å·® ${Math.abs(marginal1.h - expected.h1_marginal).toExponential(2)}</li>
                    </ul>
                `;
            } else {
                validationDiv.innerHTML = `
                    <p class="error">âŒ ä¸€éƒ¨ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒTable 1ã®æœŸå¾…å€¤ã¨ä¸€è‡´ã—ã¾ã›ã‚“ã€‚</p>
                `;
            }
        }

        console.log('âœ… ãƒ†ã‚¹ãƒˆå®Œäº†');
    </script>
</body>
</html>
